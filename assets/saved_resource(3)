!function(t){if("object"==typeof window[t]){var e,n;e=this,n=function(){"use strict";function u(t){return"function"==typeof t}function e(){var t=setTimeout;return function(){return t(n,1)}}function n(){for(var t=0;t<m;t+=2){(0,E[t])(E[t+1]),E[t]=void 0,E[t+1]=void 0}m=0}function a(t,e){var n=this,r=new this.constructor(s);void 0===r[D]&&g(r);var o=n._state;if(o){var i=arguments[o-1];A(function(){return _(o,r,i,n._result)})}else v(n,r,t,e);return r}function c(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(s);return f(e,t),e}function s(){}function p(t){try{return t.then}catch(t){return k.error=t,k}}function l(t,e,n){var r,o,i,s;e.constructor===t.constructor&&n===a&&e.constructor.resolve===c?(i=t,(s=e)._state===L?h(i,s._result):s._state===M?d(i,s._result):v(s,void 0,function(t){return f(i,t)},function(t){return d(i,t)})):n===k?(d(t,k.error),k.error=null):void 0===n?h(t,e):u(n)?(r=e,o=n,A(function(e){var n=!1,t=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(o,r,function(t){n||(n=!0,r!==t?f(e,t):h(e,t))},function(t){n||(n=!0,d(e,t))},e._label);!n&&t&&(n=!0,d(e,t))},t)):h(t,e)}function f(t,e){var n,r;t===e?d(t,new TypeError("You cannot resolve a promise with itself")):(r=typeof(n=e),null===n||"object"!==r&&"function"!==r?h(t,e):l(t,e,p(e)))}function r(t){t._onerror&&t._onerror(t._result),y(t)}function h(t,e){t._state===U&&(t._result=e,t._state=L,0!==t._subscribers.length&&A(y,t))}function d(t,e){t._state===U&&(t._state=M,t._result=e,A(r,t))}function v(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+L]=n,o[i+M]=r,0===i&&t._state&&A(y,t)}function y(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?_(n,r,o,i):o(i);t._subscribers.length=0}}function _(t,e,n,r){var o=u(n),i=void 0,s=void 0,a=void 0,c=void 0;if(o){if((i=function(t,e){try{return t(e)}catch(t){return k.error=t,k}}(n,r))===k?(c=!0,s=i.error,i.error=null):a=!0,e===i)return void d(e,new TypeError("A promises callback cannot return that same promise."))}else i=r,a=!0;e._state!==U||(o&&a?f(e,i):c?d(e,s):t===L?h(e,i):t===M&&d(e,i))}function g(t){t[D]=x++,t._state=void 0,t._result=void 0,t._subscribers=[]}var t,o,i,b,w=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},m=0,I=void 0,j=void 0,A=function(t,e){E[m]=t,E[m+1]=e,2===(m+=2)&&(j?j(n):N())},P="undefined"!=typeof window?window:void 0,T=P||{},O=T.MutationObserver||T.WebKitMutationObserver,S="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),C="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,E=new Array(1e3),N=void 0;N=S?function(){return process.nextTick(n)}:O?(o=0,i=new O(n),b=document.createTextNode(""),i.observe(b,{characterData:!0}),function(){b.data=o=++o%2}):C?((t=new MessageChannel).port1.onmessage=n,function(){return t.port2.postMessage(0)}):void 0===P&&"function"==typeof require?function(){try{var t=Function("return this")().require("vertx");return void 0!==(I=t.runOnLoop||t.runOnContext)?function(){I(n)}:e()}catch(t){return e()}}():e();var D=Math.random().toString(36).substring(2),U=void 0,L=1,M=2,k={error:null},x=0,Y=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(s),this.promise[D]||g(this.promise),w(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?h(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&h(this.promise,this._result))):d(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===U&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===c){var o=p(e);if(o===a&&e._state!==U)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===F){var i=new n(s);l(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===U&&(this._remaining--,t===M?d(r,n):this._result[e]=n),0===this._remaining&&h(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;v(t,void 0,function(t){return n._settledAt(L,e,t)},function(t){return n._settledAt(M,e,t)})},t}(),F=function(){function e(t){this[D]=x++,this._result=this._state=void 0,this._subscribers=[],s!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){f(e,t)},function(t){d(e,t)})}catch(t){d(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})})},e}();return F.prototype.then=a,F.all=function(t){return new Y(this,t).promise},F.race=function(o){var i=this;return new i(w(o)?function(t,e){for(var n=o.length,r=0;r<n;r++)i.resolve(o[r]).then(t,e)}:function(t,e){return e(new TypeError("You must pass an array to race."))})},F.resolve=c,F.reject=function(t){var e=new this(s);return d(e,t),e},F._setScheduler=function(t){j=t},F._setAsap=function(t){A=t},F._asap=A,F.polyfill=function(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=F},(F.Promise=F).polyfill(),F},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.ES6Promise=n();var r=window[t],o=function(t){this.init(t)};o.prototype={constant:{POPUP_NPS_ENDPOINT:"/function/popup-nps/",POPUP_AD_ENDPOINT:"/function/popup-ad/"},property:{core:null,conflictInstanceState:{ad:!1,nps:!1},popupNpsInstance:null,popupAdInstance:null},init:function(t){this.setCore(t)},setCore:function(t){return this.property.core=t,this},setPopupNpsInstance:function(t){return this.getCore().validateObjectType(t,"object")&&(this.property.popupNpsInstance=t),this},setPopupAdInstance:function(t){return this.getCore().validateObjectType(t,"object")&&(this.property.popupAdInstance=t),this},setConflictInstanceState:function(t,e){return(this.getCore().validateObjectType(t,"string")||this.getCore().validateObjectType(e,"boolean"))&&(this.property.conflictInstanceState[t]=e),this},getCore:function(){return this.property.core},getIsConflicted:function(){return!!this.getCore().validateObjectType(this.property.is_conflicted,"boolean")&&this.property.is_conflicted},getConflictInstanceState:function(t){return!!this.getCore().validateObjectType(this.property.conflictInstanceState[t],"boolean")&&this.property.conflictInstanceState[t]},getPopupNpsInstance:function(){return this.getCore().validateObjectType(this.property.popupNpsInstance,"object")?this.property.popupNpsInstance:null},getPopupAdInstance:function(){return this.getCore().validateObjectType(this.property.popupAdInstance,"object")?this.property.popupAdInstance:null},load:function(){var t=this.getCore(),e=0;e=r.getDevice()==r.constant.DEVICE_TYPE_PC||r.getDevice()==r.constant.DEVICE_TYPE_TABLET?1:e,e=r.getDevice()==r.constant.DEVICE_TYPE_SMARTPHONE?2:e;var n={ad:r.getLocalStorage("juicer_popup"),nps:r.getLocalStorage("juicer_nps")};n.ad=""!=n.ad?r.convertStringToObject(n.ad):{},n.ad=""!=n.ad&r.validateObjectType(n.ad[r.getSiteId()],"object")?n.ad[r.getSiteId()]:{},n.adIsShow=0<Object.keys(n.ad).length?"1":"0",n.adLastShowDate=0<Object.keys(n.ad).length&&r.validateObjectType(n.ad.last_show_date,"string")?n.ad.last_show_date:"0",n.nps=""!=n.nps?r.convertStringToObject(n.nps):{},n.nps=""!=n.nps&r.validateObjectType(n.nps[r.getSiteId()],"object")?n.nps[r.getSiteId()]:{},n.npsIsShow=0<Object.keys(n.nps).length?"1":"0",n.npsLastAnswerDate=0<Object.keys(n.nps).length&&r.validateObjectType(n.nps.last_answer_date,"string")?n.nps.last_answer_date:"0",n.npsIsAnswer=0<Object.keys(n.nps).length&&(r.validateObjectType(n.nps.is_answer,"string")||r.validateObjectType(n.nps.is_answer,"number"))?n.nps.is_answer+"":"0",t.validateObjectType(t.getConfig().siteInfo.functionPopupNps,"boolean")&&t.getConfig().siteInfo.functionPopupNps&&(this.setConflictInstanceState("nps",!0),t.loadAsync(t.getDomain()+this.constant.POPUP_NPS_ENDPOINT+"?color="+t.getColor()+"&ip="+t.getIp()+"&deviceType="+e+"&url="+encodeURIComponent(r.getUrl())+"&isShow="+n.npsIsShow+"&isAnswer="+n.npsIsAnswer+"&lastAnswerDate="+n.npsLastAnswerDate,!0)),t.validateObjectType(t.getConfig().siteInfo.functionPopupAd,"boolean")&&t.getConfig().siteInfo.functionPopupAd&&(this.setConflictInstanceState("ad",!0),t.loadAsync(t.getDomain()+this.constant.POPUP_AD_ENDPOINT+"?color="+t.getColor()+"&id="+t.getUserId()+"&ip="+t.getIp()+"&deviceType="+e+"&url="+encodeURIComponent(r.getUrl())+"&isShow="+n.adIsShow+"&lastShowDate="+n.adLastShowDate,!0))},isAvailable:function(e){var o=this,n=this.getCore(),t=[];if(this.getConflictInstanceState("nps")){var r=new Promise(function(n,t){var r=function(t){t++;var e=o.getPopupNpsInstance();5<t?n(!1):(null!=e&&n(e.isAvailable()),null==e&&setTimeout(function(){r(t)},200))};r(0)});t.push(r)}if(this.getConflictInstanceState("ad")){var i=new Promise(function(n,t){var r=function(t){t++;var e=o.getPopupAdInstance();5<t?n(!1):(null!=e&&n(e.isAvailable()),null==e&&setTimeout(function(){r(t)},200))};r(0)});t.push(i)}Promise.all(t).then(function(t){n.validateObjectType(e,"function")&&e({nps:t[0],ad:t[1]})})}};r.executeAsync(function(){var t=new o(r);r.popup=r.validateObjectType(r.popup,"object")?r.popup:t,t.load()})}}("__kit__40Rgw465Jrg=");